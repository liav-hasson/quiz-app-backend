1. apply in this order:

    kubectl apply -f sa-friend.yml

    kubectl apply -f role-portforwarding.yml

    kubectl apply -f rolebinding-portforwarding.yml

2. create sa token:

    kubectl create token friend-access -n mongodb --duration=24h

3. create kubeconfig:

CLUSTER_NAME="$(kubectl config view --minify -o jsonpath='{.clusters[0].name}')"
SERVER="$(kubectl config view --minify -o jsonpath='{.clusters[0].cluster.server}')"
CA="$(kubectl config view --raw --minify -o jsonpath='{.clusters[0].cluster.certificate-authority-data}')"
TOKEN="eyJhbGciOiJSUzI1NiIsImtpZCI6Ijg1NjRmZjFlMDFhYjcxMGVlZmRiNTZmZDk4ZDFlNDFlZTRhMmY3Y2MifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjIl0sImV4cCI6MTc2MzAxODI1NCwiaWF0IjoxNzYyOTMxODU0LCJpc3MiOiJodHRwczovL29pZGMuZWtzLmV1LW5vcnRoLTEuYW1hem9uYXdzLmNvbS9pZC9DMTYzMjAxQjJFOTdDMUU4MDhGMDJEOEU3ODZGNDE0OCIsImp0aSI6ImE4NDQ1NTUxLWFiOGEtNDk4NC1hZmNlLThlMzAxZTM2YzkyOCIsImt1YmVybmV0ZXMuaW8iOnsibmFtZXNwYWNlIjoibW9uZ29kYiIsInNlcnZpY2VhY2NvdW50Ijp7Im5hbWUiOiJmcmllbmQtYWNjZXNzIiwidWlkIjoiODEwOTY0NDMtNmJkNC00N2VjLTk4MmMtNmNjNjVmYjMxM2YxIn19LCJuYmYiOjE3NjI5MzE4NTQsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDptb25nb2RiOmZyaWVuZC1hY2Nlc3MifQ.GU92mxZbbkrHf5tyVOeODg1CDH-OIcq9of35N0PpNAraHGv-p-l3tNViQ2dxnSvU24UjoMgalD6kO_OcO74qxm5Jk2TYQwlb4yK9EO8yMlo-i-bPLsSKvajONl9984g0YNJe16UtOP72TO3nzQlwWW87XUFJZcXeKTX_LVw0S2cAOrqd02RBucGy5Dt5Dx_vmxaMN0lab1W2_li2KPmAdMdwvIskhmoiO7druzLmpysxAPqd38uyK2A6wwqyE6rKt4ZKKNkABp5KDmN_NXQuifrF9IQlU2uEy8ftPyb76fqrk-VBIZzX1FgMIYrE_od21Hs4vNtYFddopB9CR14Gcw"

cat > friend-kubeconfig <<EOF
apiVersion: v1
kind: Config
clusters:
- name: ${CLUSTER_NAME}
  cluster:
    server: ${SERVER}
    certificate-authority-data: ${CA}
contexts:
- name: friend-context
  context:
    cluster: ${CLUSTER_NAME}
    user: friend-user
current-context: friend-context
users:
- name: friend-user
  user:
    token: ${TOKEN}
EOF

# Give the file to your friend securely (scp, encrypted message, etc.)

4. the friend runs:

  kubectl --kubeconfig=friend-kubeconfig -n quizapp port-forward svc/mongodb 27017:27017