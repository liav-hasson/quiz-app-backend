1. apply in this order:

    kubectl apply -f sa-friend.yml

    kubectl apply -f role-portforwarding.yml

    kubectl apply -f rolebinding-portforwarding.yml

2. create sa token:

    kubectl create token friend-access -n mongodb --duration=24h

3. create kubeconfig:

CLUSTER_NAME="$(kubectl config view --minify -o jsonpath='{.clusters[0].name}')"
SERVER="$(kubectl config view --minify -o jsonpath='{.clusters[0].cluster.server}')"
CA="$(kubectl config view --raw --minify -o jsonpath='{.clusters[0].cluster.certificate-authority-data}')"
TOKEN=""

cat > friend-kubeconfig <<EOF
apiVersion: v1
kind: Config
clusters:
- name: ${CLUSTER_NAME}
  cluster:
    server: ${SERVER}
    certificate-authority-data: ${CA}
contexts:
- name: friend-context
  context:
    cluster: ${CLUSTER_NAME}
    user: friend-user
current-context: friend-context
users:
- name: friend-user
  user:
    token: ${TOKEN}
EOF

# Give the file to your friend securely (scp, encrypted message, etc.)

4. the friend runs:

  kubectl --kubeconfig=friend-kubeconfig -n quizapp port-forward svc/mongodb 27017:27017